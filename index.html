<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>One Page Challenge</title>
    <link href="index.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <script>
      //pokemon game
      var canvas = document.createElement("canvas");
      var ctx = canvas.getContext("2d");
      canvas.width = 1280;
      canvas.height = 800;
      document.body.appendChild(canvas);
      var bgReady = false;
      var bgImage = new Image();
      bgImage.onload = function () {
        bgReady = true;
      };
      bgImage.src = "images/background.jpg";

      var playerReady = false;
      var playerImage = new Image();
      playerImage.onload = function () {
        playerReady = true;
      };
      playerImage.src = "images/player.png";

      var pokemonReady = false;
      var pokemonImage = new Image();
      pokemonImage.onload = function () {
        pokemonReady = true;
      };
      pokemonImage.src = "images/pokemon.png";

      var player = {
        speed: 256,
        x: 0,
        y: 0,
      };

      var pokemon = {
        x: 0,
        y: 0,
      };

      var pokemonCaught = 0;

      var keysDown = {};

      addEventListener(
        "keydown",
        function (e) {
          keysDown[e.keyCode] = true;
        },
        false
      );

      addEventListener(
        "keyup",
        function (e) {
          delete keysDown[e.keyCode];
        },
        false
      );

      var reset = function () {
        player.x = canvas.width / 2;
        player.y = canvas.height / 2;

        pokemon.x = 32 + Math.random() * (canvas.width - 64);
        pokemon.y = 32 + Math.random() * (canvas.height - 64);
      };

      var update = function (mod) {
        if (38 in keysDown) {
          player.y -= player.speed * mod; //go up
        }
        if (40 in keysDown) {
          player.y += player.speed * mod; //go down
        }
        if (37 in keysDown) {
          player.x -= player.speed * mod; //go left
        }
        if (39 in keysDown) {
          player.x += player.speed * mod; //go right
        }

        if (
          player.x <= pokemon.x + 32 &&
          player.y <= pokemon.y + 32 &&
          pokemon.x <= player.x + 32 &&
          pokemon.y <= player.y + 32
        ) {
          ++pokemonCaught;
          reset();
        }
      };

      var render = function () {
        if (bgReady) {
          ctx.drawImage(bgImage, 0, 0);
        }
        if (playerReady) {
          ctx.drawImage(playerImage, player.x, player.y);
        }
        if (pokemonReady) {
          ctx.drawImage(pokemonImage, pokemon.x, pokemon.y);
        }

        ctx.fillStyle = "rgb(250,250,250)";
        ctx.font = "24px sans-serif";
        ctx.textAlign = "left";
        ctx.textBaseline = "top";
        ctx.fillText("Pokemon caught: " + pokemonCaught, 32, 32);
      };

      var main = function () {
        var now = Date.now();
        var delta = now - then;

        update(delta / 1000);
        render();

        then = now;

        requestAnimationFrame(main);
      };

      var then = Date.now();
      reset();
      main();
    </script>
  </body>
</html>
